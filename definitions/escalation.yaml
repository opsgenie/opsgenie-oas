##################
#     REQUEST    #
##################

CreateEscalationRequest:
  type: object
  required:
    - name
    - rules
  properties:
    name:
      type: string
      description: Name of the escalation
    description:
      type: string
      description: Description of the escalation
    rules:
      type: array
      description: List of escalation rules.
      items:
        $ref: '#/definitions/EscalationRule'
    ownerTeam:
      description: Owner team of escalation.
      $ref: '#/definitions/TeamMeta'

UpdateEscalationRequest:
  type: object
  properties:
    name:
      type: string
      description: Name of the escalation
    description:
      type: string
      description: Description of the escalation
    rules:
      type: array
      description: List of escalation rules.
      items:
        $ref: '#/definitions/EscalationRule'
    ownerTeam:
      description: Owner team of escalation.
      $ref: '#/definitions/TeamMeta'


##################
#    RESPONSE    #
##################

GetEscalationResponse:
  type: object
  allOf:
    - $ref: '#/definitions/BaseResponse'
    - properties:
        data:
          $ref: '#/definitions/Escalation'

ListEscalationsResponse:
  type: object
  allOf:
    - $ref: '#/definitions/BaseResponse'
    - properties:
        data:
          type: array
          items:
            $ref: '#/definitions/Escalation'

##################
#      MODEL     #
##################

Escalation:
  type: object
  properties:
    id:
      type: string
    name:
      type: string
    description:
      type: string
    rules:
      type: array
      items:
        $ref: '#/definitions/EscalationRule'
    ownerTeam:
      $ref: '#/definitions/TeamMeta'


EscalationRule:
  type: object
  required:
    - condition
    - notifiyType
    - delay
    - recipient
  properties:
    condition:
      type: string
      enum:
        - if-not-acked
        - if-not-closed
      default: if-not-acked
    notifyType:
      type: string
      enum:
        - default
        - next
        - previous
        - users
        - admins
        - all
      default: default
    delay:
      $ref: '#/definitions/Duration'
    recipient:
      $ref: '#/definitions/Recipient'

TeamMeta:
  type: object
  properties:
    id:
      type: string
    name:
      type: string

Duration:
  type: object
  required:
    - timeAmount
  properties:
    timeAmount:
      type: long
    timeUnit:
      type: string
      enum:
        - days
        - hours
        - minutes
        - seconds
        - miliseconds
        - micros
        - nanos

Recipient:
  type: object
  discriminator: type
  required:
    - type
  properties:
    type:
      type: string
      enum:
        - user
        - schedule
        - team
    id:
      type: string
    username:
      type: string
    name:
      type: string

TeamRecipient:
  x-discriminator-value: team
  description: Team recipient
  allOf:
  - $ref: '#/definitions/Recipient'
  - type: object
    properties:
      name:
        type: string
      type:
        default: team

ScheduleRecipient:
  x-discriminator-value: schedule
  description: Schedule recipient
  allOf:
  - $ref: '#/definitions/Recipient'
  - type: object
    properties:
      name:
        type: string
      type:
        default: schedule

UserRecipient:
  x-discriminator-value: user
  description: User recipient
  allOf:
  - $ref: '#/definitions/Recipient'
  - type: object
    properties:
      username:
        type: string
      type:
        default: user